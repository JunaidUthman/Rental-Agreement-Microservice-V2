### Variables
@baseUrl = http://localhost:8083
@token101 = eyJraWQiOiJlNjI1NDRkOC0yOTRhLTQ5ZTAtYjRkYS0yNjcyZDVlODllYWUiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIweDlmZWRlODY5MDI4MjJkNzU3OGQ0MjU3NmM1ZTliZDgyZGNlYjgxNmUiLCJhdWQiOiJhdXRoZW50aWZpY2F0aW9uLXNlcnZpY2UtY2xpZW50IiwibmJmIjoxNzY4NDMzNjg5LCJ3YWxsZXQiOiIweDlmZWRlODY5MDI4MjJkNzU3OGQ0MjU3NmM1ZTliZDgyZGNlYjgxNmUiLCJyb2xlIjoiUk9MRV9VU0VSIiwic2NvcGUiOlsib3BlbmlkIiwicmVhZCIsIndyaXRlIiwicHJvZmlsZSJdLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjkwMDAiLCJpZCI6MiwiZXhwIjoxNzY4NDM3Mjg5LCJpYXQiOjE3Njg0MzM2ODksImp0aSI6IjQ1OTVkNzI0LWJmNTgtNDk0Ny1iMjVmLTg1NDcxZGJiZTY5YyIsImVtYWlsIjoiYWhtYW5leWFoeWExMEBnbWFpbC5jb20ifQ.Vs6cbg0qZQFhQ4UQ24u-MLjGOB0Hu7Zq_0g2TujB_e-WVdp9yb1oB3hOjZ2Xuff9vhieTxW3um2zybxQKU-MkbYyR4nu7TxymY9vvA5g_AEDrP8DMpo-0EQaLAJP1UKPrDtcQUjYl8HVsuRQ49KbdfCpMBV77dKA4IuQLVdBvMaVTXuBs_iyoKRYztDqee4NOWHu_S0PbJZvV1LA3aeJ3WmxUhAfrlkww6BPj4O9HZfMPHgRaV3HeRSYVYndxVkoOpMSnAyXDX1aSnQfk-QjhQEORxJdhWmasL_1zV8PXt2rrZeIak7H7sk6D4T5X2CsffyXMknRmg6MfCPwg5AfJQ
@token102 = eyJraWQiOiJlNjI1NDRkOC0yOTRhLTQ5ZTAtYjRkYS0yNjcyZDVlODllYWUiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIweDc5MGE2ZGZiYWYzYTQxZGVjNDViNjY3ODEyMDA5MzgxMzY2NjI3MmMiLCJhdWQiOiJhdXRoZW50aWZpY2F0aW9uLXNlcnZpY2UtY2xpZW50IiwibmJmIjoxNzY4NDM1Mjk2LCJ3YWxsZXQiOiIweDc5MGE2ZGZiYWYzYTQxZGVjNDViNjY3ODEyMDA5MzgxMzY2NjI3MmMiLCJyb2xlIjoiUk9MRV9VU0VSIiwic2NvcGUiOlsib3BlbmlkIiwicmVhZCIsIndyaXRlIiwicHJvZmlsZSJdLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjkwMDAiLCJpZCI6MywiZXhwIjoxNzY4NDM4ODk2LCJpYXQiOjE3Njg0MzUyOTYsImp0aSI6IjA0NjU3NThjLWIzZjMtNDUzNS04ZDNjLTdiNGMzYTJiNDQ1MiIsImVtYWlsIjoiYWhtYW5lQGdtYWlsLmNvbSJ9.qrwfktsdL5aemRuscdY3OGwnUy6NLo8NE1iIas9IP5YQvAV8lpcAjkCrBtBRxZxU3jewH-7ABr-gHhOgKnQIexoNXU2DzfVSKtYu-sWdXJKjhli12iO6iRxBOIkGtsmCtCQ6cug9KVHletJxt03t0L0TSRvIQ3lfb9MxlI8YVXuugvq-9YbGadYaxJ_CoYf6_sx36TDykZuVx2x9IuvA2j7bT0-ffb49z4vcunza4v_FroFw3CAicTamv61Jp0v-S2fb_ZM3hLsxTJOD42BAQm0fqvkQfJQ0k2nRwQS__fyOa0LYPJgfyEQdOt1K_eNdW8oUAdcwpXgDk-5LRIlFXw
### 1. TEST: Créer une demande de location (Tenant userId=101)
# Notification attendue: Le propriétaire (ownerId de la propriété) devrait recevoir RENTAL_REQUEST_CREATED
POST {{baseUrl}}/api/rentalAgreement-microservice/rental-requests
Content-Type: application/json
Authorization: Bearer {{token102}}

{
  "propertyId": 5
}

###

### 2. TEST: Accepter une demande (Owner)
# Notifications attendues:
# - Le tenant (userId=101) reçoit RENTAL_REQUEST_ACCEPTED
# - Les autres tenants en attente reçoivent RENTAL_REQUEST_REJECTED
PUT {{baseUrl}}/api/rentalAgreement-microservice/rental-requests/2/status
Content-Type: application/json
Authorization: Bearer {{token101}}

{
  "status": "ACCEPTED"
}

###

### 3. TEST: Refuser une demande (Owner)
# Notification attendue: Le tenant (userId=101) reçoit RENTAL_REQUEST_REJECTED
PUT {{baseUrl}}/api/rentalAgreement-microservice/rental-requests/1/status
Content-Type: application/json
Authorization: Bearer {{token102}}

{
  "status": "REJECTED"
}

###

### 4. TEST: Créer un contrat (Tenant userId=101)
# Notifications attendues:
# - Le propriétaire (ownerId) reçoit CONTRACT_CREATED
# - Le tenant (userId=101) reçoit CONTRACT_CREATED
POST {{baseUrl}}/api/rentalAgreement-microservice/rental-contracts
Content-Type: application/json
Authorization: Bearer {{token102}}

{
  "agreementIdOnChain": 12345,
  "ownerId": 102,
  "propertyId": 1,
  "securityDeposit": 1000.0,
  "rentAmount": 500.0,
  "startDate": "2025-01-01",
  "endDate": "2025-12-31"
}

###
GET {{baseUrl}}/api/rentalAgreement-microservice/ai-models/consult-score/1


### 5. TEST: Confirmer la remise des clés (Tenant userId=101)
# Notification attendue: Le propriétaire (ownerId) reçoit KEY_DELIVERED
PUT {{baseUrl}}/api/rentalAgreement-microservice/rental-contracts/1/key-delivery
Content-Type: application/json
Authorization: Bearer {{token101}}

{
  "isKeyDelivered": true
}

###